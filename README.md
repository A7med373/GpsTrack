# Система отслеживания GPS

Система для отслеживания GPS-координат с 365gps.net и отображения их на карте.

Эта программа сделана для конкретного трекера и конкретного здания. (Ниже будет инструкция в случае, 
если надо прикрепить другой трекер либо если надо менять место, в котором идет отслеживание)

## Установка

1. Откройте терминал. Введите:

```bash
git clone https://github.com/A7med373/GpsTrack # После этого должно выйти сообщение, что репозиторий успешно клонирован
cd GpsTrack 
```

2. Введите это (все еще в терминале), чтобы узнать путь к проекту:

```bash
pwd # пример вывода: /usr/Desktop/GpsTrack
```


3. Создайте виртуальное окружение и активируйте его (все еще в терминале).

```bash
python -m venv .venv
source .venv/bin/activate  # На Windows: .venv\Scripts\activate
```

2. Установите зависимости (все еще в терминале):
```bash
pip install -r requirements.txt
```

3. Откройте второй терминал, переходите в папку проекта:
```bash
cd (сюда ставьте результат от второго пункта #например: cd /usr/Desktop/GpsTrack)
```

3. Запустите сборщик GPS-данных (в одном терминале):
```bash
python fetch_coords.py
```

4. Запустите веб-приложение (в другом терминале):
```bash
python app.py
```

5. Откройте браузер и перейдите по адресу `http://localhost:5000` и все должно работать


## Конфигурация

Система использует следующую конфигурацию по умолчанию:
- IMEI: 861261027896790
- Пароль: 1234567
- FETCH_INTERVAL: 10 секунд (интервал обновления GPS-данных, его можно настроить в файле fetch_coords.py)
- GPS_BUFFER: 0.0003 градуса (примерно 30-40 метров, буферная зона вокруг здания для учета неточности GPS, ее можно настроить в map.js)

## Если нужно менять место (здание)
Нужно менять эти координаты на координаты нового здания.
Координаты берутся из любого приложения\сайта карты (например, гугл мап):
Нажимаете на точку и выходит пара значений (например, (55.123456, 51.123456)), первое значение -- широта, второе - долгота.

```js
const ACTUAL_BUILDING_BOUNDS = {
    min_lat: 55.175553,  // Минимальная широта (левый верхний угол здания)
    max_lat: 55.176362,  // Максимальная широта (правый нижний)
    min_lng: 51.806189,  // Минимальная долгота (левый нижний)
    max_lng: 51.806758   // Максимальная долгота (правый верхний)
};
```

И нужно менять карту, вставьте нужную карту нового здания вместо floor_map.jpg (название должно оставаться).

## Если нужно менять частоту обновления точки, то достаточно менять значение FETCH_INTERVAL в fetch_coords.py.

## База данных

Система использует SQLite со следующей схемой:
- Таблица: gps_points
  - id (Integer, Primary Key)
  - lat_google (Float) - широта
  - lng_google (Float) - долгота
  - imei (String) - идентификатор устройства
  - speed (Float) - скорость в км/ч
  - signal (DateTime) - время сигнала
  - timestamp (DateTime) - время записи
  - in_actual_building (Integer) - флаг, указывающий, находится ли точка внутри фактического здания (1) или в буферной зоне (0)

## Стек

Flask, APScheduler, SQLAlchemy, requests, python-dotenv, Jinja2
Leaflet, HTML, CSS, JavaScript